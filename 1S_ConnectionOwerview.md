Как авторизоваться в системе Диадок 
===================================

Для работы с системой Диадок необходимо:
- загрузить внешнюю компоненту,
- создать соединение с сервером Диадок 
- создать контекст работы с организацией:

﻿Загрузить внешнюю компоненту 
============================

 

-   Загрузка компоненты и инициализация объекта интерфейса Диадок на
    клиенте 1С.

                    //Загрузка внешней компоненты
                    ИмяФайла = "C:\Temp\AddInDiadocAPI.dll";
                    ЗагрузитьВнешнююКомпоненту(ИмяФайла);

                    //Создание объекта DiadocInvoiceAPI
                    ДиадокАПИ_ = Новый("AddIn.DiadocInvoiceAPI");
                    ДиадокАПИ  = ДиадокАпи_.CreateObject();

                    //Задаем параметры подлючения к серверу
                    ДиадокАпи.ApiClientId = КлючРазработчика;
                    ДиадокАпи.ServerUrl   = "https://diadoc-api.kontur.ru:443";
                  

-   Загрузка внешней компоненты на сервере 1С

    В случае, когда режим запуска 1С не позволяет запуск внешних
    компонент, использующих технологию COM, (например, на стороне
    сервера 1С 8.2) необходимо использовать сборку компоненты, которая
    реализована в виде классического COM-объекта. В этом случае перед
    использованием компоненты нужно зарегистрировать файл
    DiadocComApi.dll с помощью команды regsvr32.

    В случае запуска компоненты на 64-х битном сервере, возможно,
    потребуется дополнительная регистрация компоненты DiadocComApi.dll,
    которая должна производиться в соответствии со [следующими
    рекомендациями](http://kb.mista.ru/article.php?id=870) .

    После этого загрузка и инициализация компоненты производится
    следующим образом:

                    //создаем корневой элемент COM-объекта
                    АПИObject = Новый ComОбъект("Diadoc.DiadocClient");

                    //Задаем параметры подлючения к серверу
                    ДиадокАпи.ApiClientId = КлючРазработчика;
                    ДиадокАпи.ServerUrl   = "https://diadoc-api.kontur.ru:443";
                  

Ключ разработчика представляет собой последовательность символов,
идентифицирующий разработчика интеграционного решения. Ключ разработчика
выдается бесплатно. Для того чтобы получить ключ разработчика,
необходимо отправить запрос по адресу: diadoc-api@skbkontur.ru.

Создать соединение и авторизоваться 
===================================

Для авторизации и последующих вызовов методов сервера Диадок необходимо
создать объект [DiadocConnection](1S_DiadocConnection_Desc), который
представляет собой соединение с сервером. Соединение следует создавать
на каждый сеанс работы. Явно освобождать ресурсы после окончания работы
с этим объектом не нужно.

При создании объекта DiadocConnection необходимо указать отпечаток
сертификата для авторизации на сервере. Отпечаток сертификата можно
узнать, получив список и описание всех доступных сертификатов методом
[GetPersonalSertificates](1S_DiadocObj_GetPersonalSertificates).

            // создание объекта контекста API
            ДиадокАПИ_ = Новый("AddIn.DiadocInvoiceAPI");
            ДиадокАПИ  = ДиадокАпи_.CreateObject();

            //Получение списка сертификатов
            Certificates = ДиадокАПИ.GetPersonalCertificates();

            //создание соединения, здесь в явном виде указан отпечаток сертификата
            //в рабочем варианте его надо получить из коллекции Certificates
            //Например так PersonalCertificate = Certificates.GetItem(0).Thumbprint;
            ДиадокСоединение = ДиадокАПИ.CreateConnectionByCertificate("3E859FA8FB718FB691A793AE1206C5EE85574AFD");

﻿Создать контекст работы с организацией 
======================================
 
Все действия с документами: отправка, получение, подписание и т.д.
выполняются в контексте организации, к которой пользователь имеет права
доступа в системе Диадок. Для работы с контекстом организации
предназначен объект [Organization](1S_Organization_Desc). Он получается
через объект [DiadocConnection](1S_DiadocConnection_Desc). Получить
объект Organization можно одним из двух способов:

-   Получив объект [Organization](1S_Organization_Desc) по
    идентификатору. Пример:

                    OrganizationId = "8fd0af8abe934c7091b5ccd476ef1cb5@diadoc.ru";
                    ДиадокКонтекстОрганизации = ДиадокСоединение.GetOrganizationById(OrganizationId);
                  

-   Получив массив всех объектов [Organization](1S_Organization_Desc)
    всех доступных ящиков. Пример:

                      OrganizationList = ДиадокСоединение.GetOrganizationList();
                        Ц = 0;
                        Пока Ц < OrganizationList.Count() Цикл
                          Organization = OrganizationList.GetItem(ц);
                          Сообщить(Organization.Name);
                        Ц = Ц + 1;
                      КонецЦикла;
                    
       



